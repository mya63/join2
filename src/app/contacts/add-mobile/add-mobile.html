<div class="mobile-add-backdrop" [class.closing]="isClosing" (click)="closeOverlay()">
  <div class="contact-add-mobile" [class.closing]="isClosing" (click)="$event.stopPropagation()">

    <!-- Top dark panel -->
    <section class="panel-dark">
      <h1>Add contact</h1>
      <span class="divider"></span>
    </section>

    <!-- Avatar -->
    <div class="avatar" [style.background]="contact.color">
      <img src="assets/img/contacts/edit-mobile/person-large-add.svg" alt="Person Icon">
    </div>

    <!-- Form -->
    <form class="form-fields" #f="ngForm" novalidate>
      <div class="field-wrapper">
        <label class="field">
          <input 
            type="text" 
            [(ngModel)]="contact.name" 
            name="name" 
            placeholder="Name" 
            required 
            #nameInput="ngModel"
            [class.invalid]="nameInput.invalid && nameInput.touched" />
          <span class="icon i-person"><img src="assets/img/contacts/edit-mobile/person-icon-only.svg" alt="Person Icon" /></span>
        </label>
        <div class="validation-message">
          @if (nameInput.invalid && nameInput.touched) {
            @if (nameInput.errors?.['required']) {
              <span>Name ist ein Pflichtfeld.</span>
            }
          } @else if (nameInput.touched && hasInvalidCapitalization(contact.name)) {
            <span>Der erste Buchstabe muss groß geschrieben werden.</span>
          }
        </div>
      </div>

      <div class="field-wrapper">
        <label class="field">
          <input 
            type="text" 
            [(ngModel)]="contact.surname" 
            name="surname" 
            placeholder="Surname" 
            required 
            #surnameInput="ngModel"
            [class.invalid]="surnameInput.invalid && surnameInput.touched" />
          <span class="icon i-person"><img src="assets/img/contacts/edit-mobile/person-icon-only.svg" alt="Person Icon" /></span>
        </label>
        <div class="validation-message">
          @if (surnameInput.invalid && surnameInput.touched) {
            @if (surnameInput.errors?.['required']) {
              <span>Nachname ist ein Pflichtfeld.</span>
            }
          } @else if (surnameInput.touched && hasInvalidCapitalization(contact.surname)) {
            <span>Der erste Buchstabe muss groß geschrieben werden.</span>
          }
        </div>
      </div>

      <div class="field-wrapper">
        <label class="field">
          <input 
            type="email" 
            [(ngModel)]="contact.email" 
            name="email" 
            placeholder="Email" 
            required 
            email
            #emailInput="ngModel"
            [class.invalid]="emailInput.invalid && emailInput.touched" />
          <span class="icon i-mail"><img src="assets/img/contacts/edit-mobile/mail-icon-only.svg" alt="Mail Icon" /></span>
        </label>
        <div class="validation-message">
          @if (emailInput.invalid && emailInput.touched) {
            @if (emailInput.errors?.['required']) {
              <span>Email ist ein Pflichtfeld.</span>
            } @else if (emailInput.errors?.['email']) {
              <span>Bitte geben Sie eine gültige Email-Adresse ein.</span>
            }
          } @else if (emailInput.touched && hasInvalidEmailFormat(contact.email)) {
            <span>Email muss das Format name@domain.endung haben.</span>
          }
        </div>
      </div>

      <div class="field-wrapper">
        <label class="field">
          <input 
            type="tel" 
            [(ngModel)]="contact.phone" 
            name="phone" 
            placeholder="Phone" 
            #phoneInput="ngModel"
            [class.invalid]="(phoneInput.invalid && phoneInput.touched) || (phoneInput.touched && hasInvalidPhoneFormat(contact.phone))" />
          <span class="icon i-call"><img src="assets/img/contacts/edit-mobile/call-icon-only.svg" alt="Call Icon" /></span>
        </label>
        <div class="validation-message">
          @if (phoneInput.touched && hasInvalidPhoneFormat(contact.phone)) {
            <span>Telefonnummer muss mind. 6 Ziffern lang sein.</span>
          }
        </div>
      </div>
    </form>

    <!-- Action Buttons -->
    <div class="buttons">
      <button class="btn-create" type="button" (click)="addContact()" [disabled]="!isFormValid(f)">
        <span>Create contact</span>
        <span class="icon-check" > <img src="assets/img/contacts/edit-mobile/check-icon-only.svg" alt="Check" /></span>
      </button>
    </div>

    <!-- Close icon (unsichtbare Klickfläche wie Figma) -->
    <button class="btn-close" type="button" aria-label="Close" (click)="closeOverlay() " >
      <img src="assets/img/contacts/edit-mobile/x-vector-white-icon-only.svg" alt="Close">
    </button>
  </div>
</div>
 