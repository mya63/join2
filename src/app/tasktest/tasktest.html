<div class="tasktest">
  <div class="taskOperation">
    <form class="inputTask" (ngSubmit)="addTask(task)">


      <div class="inputField">
        <p>13. Assign To:</p>
        <div class="assign-to-dropdown">
          <div class="dropdown-header" (click)="toggleAssignDropdown('task')">
            <span class="selected-users">
              @if (task.assignTo && task.assignTo.length > 0) {
                @for (user of task.assignTo; track user) {
                  {{ user.name }} {{ user.surname }}@if (!$last) {, }
                }
              } @else {
                assign users
              }
            </span>
            <span class="dropdown-arrow" [class.open]="showAssignDropdown.task">▼</span>
          </div>
          @if (showAssignDropdown.task) {
          <div class="assign-to-container">
            @for (user of this.getUserForTask(); track user) {
            <label class="user-checkbox">
              <input 
                type="checkbox" 
                [checked]="isUserAssigned(user, task.assignTo)"
                (change)="toggleUserAssignment(user, task.assignTo)"
              >
              {{ user.name }} {{ user.surname }}
            </label>
            }
          </div>
          }
        </div>
      </div>





      <p class="inputField ">14. Due Date:<span class="out"><input class="in" name="dueDate" [(ngModel)]="task.dueDate"
            placeholder="Due Date" required> <img src="assets/img/board/calendar.svg" alt="Calendar"
            (click)="openCalendar('task')" class="calendar-icon"></span></p>

      <p class="inputField">15. Category: <select name="category" [(ngModel)]="task.category.category" required>
          @for (option of categoryOptions.categoryProperties; track option) {
          <option [value]="$index">{{ option.name }}</option>
          }
        </select></p>
      <p class="inputField">16. Title:<input name="title" [(ngModel)]="task.title" placeholder="Title" required></p>
      <p class="inputField">17. Description: <input name="description" [(ngModel)]="task.description"
          placeholder="Description" required></p>
      <p class="inputField">18. Priority: <select name="priority" [(ngModel)]="task.priority" required>
          @for (option of priorityOptions; track option) {
          <option [value]="option">{{ option }}</option>
          }
        </select></p>
      <p class="inputField">19. Status: <select name="status" [(ngModel)]="task.status" required>
          @for (option of statusOptions; track option) {
          <option [value]="option">{{ option }}</option>
          }
        </select></p>
      <p class="inputField">20. Position Index: <input name="positionIndex" [(ngModel)]="task.positionIndex"
          placeholder="Position Index" required></p>
      <p class="inputField">21. Completed: <select name="completed" [(ngModel)]="task.completed" required>
          <option [value]="true">completed</option>
          <option [value]="false">not completed</option>
        </select></p>


      <button type="submit" [disabled]="!task.title">Add Task</button>
    </form>
    <form class="inputTask" (ngSubmit)="updateTask()">

      <div class="inputField">
        <p>13. Assign To:</p>
        <div class="assign-to-dropdown">
          <div class="dropdown-header" (click)="toggleAssignDropdown('currentTask')">
            <span class="selected-users">
              @if (currentTask.assignTo && currentTask.assignTo.length > 0) {
                @for (user of currentTask.assignTo; track user) {
                  {{ user.name }} {{ user.surname }}@if (!$last) {, }
                }
              } @else {
                assign users...
              }
            </span>
            <span class="dropdown-arrow" [class.open]="showAssignDropdown.currentTask">▼</span>
          </div>
          @if (showAssignDropdown.currentTask) {
          <div class="assign-to-container">
            @for (user of this.getUserForTask(); track user) {
            <label class="user-checkbox">
              <input 
                type="checkbox" 
                [checked]="isUserAssigned(user, currentTask.assignTo)"
                (change)="toggleUserAssignment(user, currentTask.assignTo)"
              >
              {{ user.name }} {{ user.surname }}
            </label>
            }
          </div>
          }
        </div>
      </div>

      <p class="inputField ">14. Due Date:<span class="out"><input class="in" name="dueDate"
            [(ngModel)]="currentTask.dueDate" placeholder="Due Date" required> <img src="assets/img/board/calendar.svg"
            alt="Calendar" (click)="openCalendar('currentTask')" class="calendar-icon"></span></p>
      <p class="inputField">15. Category: <select name="category" [(ngModel)]="currentTask.category.category" required>
          @for (option of categoryOptions.categoryProperties; track option) {
          <option [value]="$index">{{ option.name }}</option>}
        </select></p>
      <p class="inputField">16. Title:<input name="title" [(ngModel)]="currentTask.title" placeholder="Title" required>
      </p>
      <p class="inputField">17. Description: <input name="description" [(ngModel)]="currentTask.description"
          placeholder="Description" required></p>
      <p class="inputField">18. Priority: <select name="priority" [(ngModel)]="currentTask.priority" required>
          @for (option of priorityOptions; track option) {
          <option [value]="option">{{ option }}</option>
          }
        </select></p>
      <p class="inputField">19. Status: <select name="status" [(ngModel)]="currentTask.status" required>
          @for (option of statusOptions; track option) {
          <option [value]="option">{{ option }}</option>
          }
        </select></p>
      <p class="inputField">20. Position Index: <input name="positionIndex" [(ngModel)]="currentTask.positionIndex"
          placeholder="Position Index" required></p>
      <p class="inputField">21. Completed: <select name="completed" [(ngModel)]="currentTask.completed" required>
          <option [value]="true">completed</option>
          <option [value]="false">not completed</option>
        </select></p>


      <button type="submit" [disabled]="!currentTask.title">Save</button>
      30. dbid: {{ currentTask.dbid }}<br>
    </form>
    <button (click)="nextTask()">Next Task</button>
  </div>

  <p>My Tasks:</p>
  @for (item of gettasks(); track item.dbid) {
  <button (click)="deleteTask(item.dbid)">Delete Task {{ $index + 1 }}</button>
  <p>
    5. Due Date: {{ item.dueDate }}<br>
    <span style.color="{{ item.category.categoryProperties[item.category.category].color }}">9. Category Name: {{
      item.category.categoryProperties[item.category.category].name }}</span><br>
    10. Title: {{ item.title }}<br>
    11. Description: {{ item.description }}<br>
    12. Assign To: 
    @for (assignedUser of item.assignTo; track assignedUser) {
      {{ assignedUser.name }} {{ assignedUser.surname }}@if (!$last) {, }
    }<br>
    13. Priority: {{ item.priority }}<br>
    14. SubTasks: {{ item.subTasks.length }} items<br>
    19. Status: {{ item.status }}<br>
    20. Position Index: {{ item.positionIndex }}<br>
    21. Completed: {{ item.completed }}<br>
    22. Owner ID: {{ item.ownerId }}<br>
    23. Create Date: {{ item.createDate }}<br>
    30. dbid: {{ item.dbid }}<br>
  </p>
  <hr>
  }

  <!-- Kalender Widget -->
  @if (showCalendar) {
  <div class="calendar-overlay" (click)="closeCalendar()">
    <div class="calendar-widget" (click)="$event.stopPropagation()">
      <div class="calendar-header">
        <button type="button" (click)="previousMonth()" class="nav-btn">‹</button>
        <span class="month-year">{{ getMonthName(currentMonth) }} {{ currentYear }}</span>
        <button type="button" (click)="nextMonth()" class="nav-btn">›</button>
      </div>
      <div class="calendar-grid">
        <div class="day-header">So</div>
        <div class="day-header">Mo</div>
        <div class="day-header">Di</div>
        <div class="day-header">Mi</div>
        <div class="day-header">Do</div>
        <div class="day-header">Fr</div>
        <div class="day-header">Sa</div>

        @for (day of getCalendarDays(); track $index) {
        @if (day === null) {
        <div class="calendar-day empty"></div>
        } @else {
        <div class="calendar-day" [class.past]="isDayInPast(day)"
          [class.today]="currentYear === today.getFullYear() && currentMonth === today.getMonth() && day === today.getDate()"
          (click)="onDayClick(day)">
          {{ day }}
        </div>
        }
        }
      </div>
      <button type="button" (click)="closeCalendar()" class="close-btn">Schließen</button>
    </div>
  </div>
  }

</div>